cmake_minimum_required(VERSION 3.24)

if(NOT DEFINED CMAKE_TOOLCHAIN_FILE)
  message(FATAL_ERROR "Please set CMAKE_TOOLCHAIN_FILE to OpenOrbis-tc.cmake")
elseif(NOT CMAKE_TOOLCHAIN_FILE MATCHES "OpenOrbis-tc")
  message(FATAL_ERROR "CMAKE_TOOLCHAIN_FILE must point to OpenOrbis-tc.cmake")
endif()


include(FetchContent)
include(ExternalProject)

project(integration_tests_super NONE)

# # project
ExternalProject_Add(
  integration_tests
  SOURCE_DIR ${CMAKE_SOURCE_DIR}/tests
  BINARY_DIR ${CMAKE_BINARY_DIR}/tests
  CMAKE_ARGS
  -DCMAKE_TOOLCHAIN_FILE=${CMAKE_SOURCE_DIR}/OpenOrbis-tc.cmake
  -DOO_PS4_LINKER_SUFFIX=${OO_PS4_LINKER_SUFFIX}
  -DOO_PS4_NOPKG=${OO_PS4_NOPKG}
  -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
  -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
  -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
  -DCMAKE_INSTALL_PREFIX=${CMAKE_BINARY_DIR}/install
  -DINTEST_SOURCE_ROOT=${CMAKE_SOURCE_DIR}
  -DOO_PS4_TOOLCHAIN=${OO_PS4_TOOLCHAIN}
  BUILD_ALWAYS 1
)
